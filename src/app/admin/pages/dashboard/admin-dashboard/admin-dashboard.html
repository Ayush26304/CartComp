<div class="admin-dashboard">
  <!-- Navigation Header -->
  <div class="admin-header">
    <div class="header-left">
      <h1>Admin Dashboard</h1>
    </div>
    <div class="header-right">
      <span class="admin-user">üëë Admin</span>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
    <nav class="admin-nav">
      <button 
        [class.active]="activeSection === 'overview'"
        (click)="setActiveSection('overview')"
        class="nav-btn"
      >
        Overview
      </button>
      <button 
        [class.active]="activeSection === 'users'"
        (click)="setActiveSection('users')"
        class="nav-btn"
      >
        Users
      </button>
      <button 
        [class.active]="activeSection === 'categories'"
        (click)="setActiveSection('categories')"
        class="nav-btn"
      >
        Categories
      </button>
      <button 
        [class.active]="activeSection === 'products'"
        (click)="setActiveSection('products')"
        class="nav-btn"
      >
        Products
      </button>
      <button 
        [class.active]="activeSection === 'orders'"
        (click)="setActiveSection('orders')"
        class="nav-btn"
      >
        Orders
      </button>
    </nav>
  </div>

  <!-- Content Area -->
  <div class="admin-content">

    <!-- Overview Section -->
    <div *ngIf="activeSection === 'overview'" class="overview-section">
      <h2>Dashboard Overview</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-info">
            <h3>{{stats.totalUsers}}</h3>
            <p>Total Users</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üì¶</div>
          <div class="stat-info">
            <h3>{{stats.totalProducts}}</h3>
            <p>Total Products</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üè∑Ô∏è</div>
          <div class="stat-info">
            <h3>{{stats.totalCategories}}</h3>
            <p>Categories</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üõí</div>
          <div class="stat-info">
            <h3>{{stats.totalOrders}}</h3>
            <p>Total Orders</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Section -->
    <div *ngIf="activeSection === 'users'" class="users-section">
      <div class="section-header">
        <h2>User Management ({{users.length}} users)</h2>
        <div class="section-actions">
          <button class="btn-secondary" (click)="loadUsers()" [disabled]="loading.users">
            {{ loading.users ? 'Loading...' : 'Refresh' }}
          </button>
          <button class="btn-primary" (click)="openUserModal()">Add New User</button>
        </div>
      </div>
      
      <div *ngIf="loading.users" class="loading">Loading users...</div>
      
      <div *ngIf="!loading.users" class="data-table">
        <table *ngIf="users && users.length > 0">
          <thead>
            <tr>
              <th>ID</th>
              <th>Username</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>{{user.id}}</td>
              <td>{{user.username || 'N/A'}}</td>
              <td>{{user.firstName}} {{user.lastName}}</td>
              <td>{{user.email || 'N/A'}}</td>
              <td>{{user.phoneNumber || 'N/A'}}</td>
              <td>{{user.createdAt ? formatDate(user.createdAt) : 'N/A'}}</td>
              <td>
                <button class="btn-edit" (click)="editUser(user)">Edit</button>
                <button class="btn-delete" (click)="deleteUser(user.id)">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
        
        <div *ngIf="!users || users.length === 0" class="no-data">
          <p>No users found or data not loaded yet.</p>
        </div>
      </div>
    </div>

    <!-- Categories Section -->
    <div *ngIf="activeSection === 'categories'" class="categories-section">
      <div class="section-header">
        <h2>Category Management ({{categories.length}} categories)</h2>
        <div class="section-actions">
          <button class="btn-secondary" (click)="loadCategories()" [disabled]="loading.categories">
            {{ loading.categories ? 'Loading...' : 'Refresh' }}
          </button>
          <button class="btn-primary" (click)="openCategoryModal()">Add New Category</button>
        </div>
      </div>
      
      <div *ngIf="loading.categories" class="loading">Loading categories...</div>
      
      <div *ngIf="!loading.categories" class="data-table">
        <table *ngIf="categories && categories.length > 0">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let category of categories">
              <td>{{category.id}}</td>
              <td>{{category.name}}</td>
              <td>{{category.description}}</td>
              <td>
                <button class="btn-edit" (click)="editCategory(category)">Edit</button>
                <button class="btn-delete" (click)="deleteCategory(category.id)">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
        
        <div *ngIf="!categories || categories.length === 0" class="no-data">
          <p>No categories found or data not loaded yet.</p>
        </div>
      </div>
    </div>

    <!-- Products Section -->
    <div *ngIf="activeSection === 'products'" class="products-section">
      <div class="section-header">
        <h2>Product Management ({{products.length}} products)</h2>
        <div class="section-actions">
          <button class="btn-secondary" (click)="loadProducts()" [disabled]="loading.products">
            {{ loading.products ? 'Loading...' : 'Refresh' }}
          </button>
          <button class="btn-primary" (click)="openProductModal()">Add New Product</button>
        </div>
      </div>
      
      <div *ngIf="loading.products" class="loading">Loading products...</div>
      
      <div *ngIf="!loading.products" class="data-table">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Price</th>
              <th>Stock</th>
              <th>Category</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of products">
              <td>{{product.id}}</td>
              <td>{{product.name}}</td>
              <td>{{formatCurrency(product.price)}}</td>
              <td>{{product.stock}}</td>
              <td>{{product.categoryId}}</td>
              <td>
                <button class="btn-edit" (click)="editProduct(product)">Edit</button>
                <button class="btn-delete" (click)="deleteProduct(product.id)">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Orders Section -->
    <div *ngIf="activeSection === 'orders'" class="orders-section">
      <div class="section-header">
        <h2>Order Management ({{orders.length}} orders)</h2>
        <div class="section-actions">
          <button class="btn-secondary" (click)="loadOrders()" [disabled]="loading.orders">
            {{ loading.orders ? 'Loading...' : 'Refresh' }}
          </button>
        </div>
      </div>
      
      <div *ngIf="loading.orders" class="loading">Loading orders...</div>
      
      <div *ngIf="!loading.orders" class="data-table">
        <table *ngIf="orders && orders.length > 0">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer Name</th>
              <th>Invoice Number</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of orders">
              <td>#{{order.orderId}}</td>
              <td>{{order.shipping?.fullName || 'N/A'}}</td>
              <td>{{order.invoiceNumber}}</td>
              <td>{{order.items?.length || 0}} items</td>
              <td>{{formatCurrency(order.totalAmount)}}</td>
              <td>
                <select 
                  [value]="order.status" 
                  (change)="updateOrderStatus(order.orderId, $event)"
                  class="status-select"
                  [class]="'status-' + order.status?.toLowerCase()"
                >
                  <option value="PENDING">PENDING</option>
                  <option value="CONFIRMED">CONFIRMED</option>
                  <option value="PROCESSING">PROCESSING</option>
                  <option value="SHIPPED">SHIPPED</option>
                  <option value="OUT_FOR_DELIVERY">OUT FOR DELIVERY</option>
                  <option value="DELIVERED">DELIVERED</option>
                  <option value="CANCELLED">CANCELLED</option>
                  <option value="RETURNED">RETURNED</option>
                </select>
              </td>
              <td>{{order.orderDate ? formatDate(order.orderDate) : 'N/A'}}</td>
              <td>
                <button class="btn-view" (click)="viewOrderDetails(order.orderId)">View Details</button>
                <button class="btn-invoice" (click)="downloadInvoice(order.orderId)">Invoice</button>
                <button class="btn-delete" (click)="deleteOrder(order.orderId)">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
        
        <div *ngIf="!orders || orders.length === 0" class="no-data">
          <p>No orders found or data not loaded yet.</p>
          <p><small>Make sure the backend has admin order endpoints implemented.</small></p>
        </div>
      </div>
    </div>

  </div>

  <!-- Modals -->
  <app-user-modal
    *ngIf="modals.user.visible"
    [isVisible]="modals.user.visible"
    [isEdit]="modals.user.isEdit"
    [userData]="modals.user.data"
    (close)="closeUserModal()"
    (save)="onUserSaved($event)"
  ></app-user-modal>

  <app-category-modal
    *ngIf="modals.category.visible"
    [isVisible]="modals.category.visible"
    [isEdit]="modals.category.isEdit"
    [categoryData]="modals.category.data"
    (close)="closeCategoryModal()"
    (save)="onCategorySaved($event)"
  ></app-category-modal>

  <app-product-modal
    *ngIf="modals.product.visible"
    [isVisible]="modals.product.visible"
    [isEdit]="modals.product.isEdit"
    [productData]="modals.product.data"
    (close)="closeProductModal()"
    (save)="onProductSaved($event)"
  ></app-product-modal>
</div>
