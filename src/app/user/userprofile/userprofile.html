<app-navbar *ngIf="showNavbar"></app-navbar>

<div class="profile-container">
  <!-- LEFT SIDEBAR -->
  <div class="profile-sidebar">
    <div class="user-card">
      <div class="user-info-header">
        <img [src]="user.image" alt="User Avatar" class="avatar" />
        <div class="user-details">
          <h3>{{ user.name || 'User' }}</h3>
          <p class="user-email">{{ user.email || 'No email provided' }}</p>
          <span class="user-badge">Prime Member</span>
        </div>
      </div>

      <div class="profile-form-section">
        <div class="section-header">
          <h4>Account Information</h4>
          <button 
            class="toggle-edit-btn" 
            type="button" 
            (click)="toggleEditMode()"
          >
            {{ isEditMode ? 'Cancel' : 'Edit' }}
          </button>
        </div>

        <form [formGroup]="profileForm" (ngSubmit)="editProfile()">
          <div class="form-grid">
            <div class="form-group">
              <label>Full Name</label>
              <input 
                formControlName="fullName" 
                placeholder="Enter your full name"
                [readonly]="!isEditMode"
                [class.readonly]="!isEditMode"
              />
            </div>
            
            <div class="form-group">
              <label>Phone Number</label>
              <input 
                formControlName="phone" 
                placeholder="Enter phone number"
                [readonly]="!isEditMode"
                [class.readonly]="!isEditMode"
              />
            </div>
            
            <div class="form-group">
              <label>Address Line 1</label>
              <input 
                formControlName="addressLine1" 
                placeholder="Street address"
                [readonly]="!isEditMode"
                [class.readonly]="!isEditMode"
              />
            </div>
            
            <div class="form-group">
              <label>Address Line 2</label>
              <input 
                formControlName="addressLine2" 
                placeholder="Apartment, suite, etc."
                [readonly]="!isEditMode"
                [class.readonly]="!isEditMode"
              />
            </div>
            
            <div class="form-group">
              <label>City</label>
              <input 
                formControlName="city" 
                placeholder="Enter city"
                [readonly]="!isEditMode"
                [class.readonly]="!isEditMode"
              />
            </div>
            
            <div class="form-group">
              <label>State</label>
              <input 
                formControlName="state" 
                placeholder="Enter state"
                [readonly]="!isEditMode"
                [class.readonly]="!isEditMode"
              />
            </div>
            
            <div class="form-group">
              <label>Postal Code</label>
              <input 
                formControlName="postalCode" 
                placeholder="Enter postal code"
                [readonly]="!isEditMode"
                [class.readonly]="!isEditMode"
              />
            </div>
            
            <div class="form-group">
              <label>Country</label>
              <input 
                formControlName="country" 
                placeholder="Enter country"
                [readonly]="!isEditMode"
                [class.readonly]="!isEditMode"
              />
            </div>
          </div>
          
          <button 
            *ngIf="isEditMode" 
            class="save-btn" 
            type="submit"
          >
            Save Changes
          </button>
        </form>
      </div>
    </div>

    <nav class="sidebar-nav">
      <h4>Your Account</h4>
      <ul class="nav-list">
        <li
          *ngFor="let tab of tabs"
          (click)="selectTab(tab)"
          [class.active]="tab === activeTab"
          class="nav-item"
        >
          <i class="nav-icon" [ngClass]="getTabIcon(tab)"></i>
          <span>{{ tab }}</span>
        </li>
      </ul>
    </nav>
  </div>

  <!-- RIGHT CONTENT -->
  <div class="profile-content">
    <!-- Orders Section -->
    <div *ngIf="activeTab === 'Orders'" class="orders-section">
      <div class="section-header-main">
        <h2>Your Orders</h2>
        <button class="refresh-btn" (click)="loadUserOrders()" [disabled]="loadingOrders">
          <span *ngIf="!loadingOrders">üîÑ Refresh</span>
          <span *ngIf="loadingOrders">Loading...</span>
        </button>
      </div>

      <!-- Loading State -->
      <div *ngIf="loadingOrders" class="loading-orders">
        <div class="spinner"></div>
        <p>Loading your orders...</p>
      </div>

      <!-- Orders List -->
      <div *ngIf="!loadingOrders && orders.length > 0; else noOrders">
        <div class="order-card-main" *ngFor="let order of orders">
          <div class="order-header-main">
            <div class="order-meta">
              <div class="order-info">
                <span class="order-label">ORDER PLACED</span>
                <span class="order-date">{{ formatOrderDate(order.orderDate) }}</span>
              </div>
              <div class="order-info">
                <span class="order-label">TOTAL</span>
                <span class="order-total">‚Çπ{{ order.totalAmount }}</span>
              </div>
              <div class="order-info">
                <span class="order-label">SHIP TO</span>
                <span class="ship-to">{{ order.shipping.fullName }}</span>
              </div>
            </div>
            <div class="order-id-section">
              <span class="order-id-label">Order #{{ order.orderId }}</span>
              <span class="invoice-number">{{ order.invoiceNumber }}</span>
              <div class="order-actions">
                <button class="order-action-btn" (click)="trackOrder(order.orderId)">
                  üì¶ Track Order
                </button>
                <button class="order-action-btn" (click)="downloadInvoice(order.orderId)">
                  üìÑ Invoice
                </button>
              </div>
            </div>
          </div>

          <div class="order-status-bar">
            <span class="order-status-main" [class]="getStatusClass(order.status)">
              {{ order.status.replace('_', ' ') }}
            </span>
          </div>

          <div class="order-items">
            <div class="order-item-main" *ngFor="let item of order.items">
              <div class="item-details-main">
                <h4 class="item-title">{{ item.productName }}</h4>
                <p class="item-price">‚Çπ{{ item.price }} √ó {{ item.quantity }}</p>
                <p class="item-subtotal">Subtotal: ‚Çπ{{ item.price * item.quantity }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noOrders>
        <div class="empty-state">
          <div class="empty-icon">üì¶</div>
          <h3>No orders yet</h3>
          <p>When you place your first order, it will appear here</p>
          <button class="start-shopping-btn">Start Shopping</button>
        </div>
      </ng-template>
    </div>

    <!-- Favorites Section -->
    <div *ngIf="activeTab === 'Favorites'" class="favorites-section">
      <div class="section-header-main">
        <h2>Your Wish List</h2>
        <div class="wishlist-actions">
          <span class="wishlist-count">{{ favorites.length }} items</span>
          <button class="refresh-btn" (click)="loadFavorites()" [disabled]="loadingFavorites">
            <span *ngIf="!loadingFavorites">üîÑ Refresh</span>
            <span *ngIf="loadingFavorites">Loading...</span>
          </button>
        </div>
      </div>
      
      <!-- Loading State -->
      <div *ngIf="loadingFavorites" class="loading-favorites">
        <div class="spinner"></div>
        <p>Loading your wishlist...</p>
      </div>
      
      <div *ngIf="!loadingFavorites && favorites.length > 0; else noFavs" class="favorites-grid">
        <div class="favorite-item-card" *ngFor="let product of favorites">
          <div class="favorite-image-container">
            <img [src]="product.imageUrl || 'https://via.placeholder.com/200x200?text=No+Image'" [alt]="product.name" />
            <button class="remove-favorite-btn" (click)="removeFromWishlist(product)" title="Remove from wishlist">√ó</button>
          </div>
          <div class="favorite-details">
            <h4 class="favorite-title">{{ product.name }}</h4>
            <p class="favorite-description">{{ product.description }}</p>
            <p class="favorite-price">‚Çπ{{ product.price | number:'1.2-2' }}</p>
            <div class="favorite-stock" *ngIf="product.stock > 0; else outOfStock">
              <span class="stock-available">‚úÖ In Stock ({{ product.stock }} available)</span>
            </div>
            <ng-template #outOfStock>
              <span class="stock-unavailable">‚ùå Out of Stock</span>
            </ng-template>
            <div class="favorite-actions">
              <button 
                class="add-to-cart-btn" 
                (click)="addToCartFromWishlist(product)"
                [disabled]="product.stock === 0"
              >
                Add to Cart
              </button>
              <button class="view-product-btn" (click)="router.navigate(['/product', product.id])">
                View Details
              </button>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noFavs>
        <div class="empty-state">
          <div class="empty-icon">‚ù§Ô∏è</div>
          <h3>Your Wish List is empty</h3>
          <p>Save items you're interested in to your wish list by clicking the ‚ô• icon on any product</p>
          <button class="continue-shopping-btn" (click)="router.navigate(['/categories'])">Continue Shopping</button>
        </div>
      </ng-template>
    </div>

    <!-- Address Section -->
    <div *ngIf="activeTab === 'Addresses'" class="address-section">
      <div class="section-header-main">
        <h2>Your Addresses</h2>
        <button class="add-address-btn">Add New Address</button>
      </div>
      
      <div *ngIf="addresses.length; else noAddr" class="addresses-grid">
        <div class="address-card-main" *ngFor="let a of addresses; let i = index">
          <div class="address-header">
            <h4>{{ a.name || 'Address ' + (i + 1) }}</h4>
            <div class="address-actions">
              <button class="edit-address-btn">Edit</button>
              <button class="delete-address-btn">Delete</button>
            </div>
          </div>
          
          <div class="address-content">
            <div class="address-lines">
              <p *ngIf="a.line1"><strong>{{ a.line1 }}</strong></p>
              <p *ngIf="a.line2">{{ a.line2 }}</p>
              <p class="address-city-state" *ngIf="a.city || a.state || a.zip">
                <span *ngIf="a.city">{{ a.city }}</span><span *ngIf="a.city && a.state">, </span><span *ngIf="a.state">{{ a.state }}</span>
                <span *ngIf="a.zip"> - {{ a.zip }}</span>
              </p>
              <p *ngIf="a.country" class="address-country">{{ a.country }}</p>
              
              <!-- Show message if no address data -->
              <div *ngIf="!a.line1 && !a.city && !a.state" class="no-address-message">
                <p><em>No address information available. Please update your profile to add an address.</em></p>
              </div>
            </div>
            
            <div class="address-contact" *ngIf="a.phone">
              <p><i class="phone-icon">üì±</i> {{ a.phone }}</p>
            </div>
            
            <div class="address-labels">
              <span class="address-type-label">{{ a.type || 'Home' }}</span>
              <span *ngIf="a.isDefault" class="default-label">Default</span>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noAddr>
        <div class="empty-state">
          <div class="empty-icon">üè†</div>
          <h3>No addresses saved yet</h3>
          <p>Add an address to make checkout faster</p>
          <button class="add-first-address-btn">Add Your First Address</button>
        </div>
      </ng-template>
    </div>
  </div>
</div>

<app-footer *ngIf="showNavbar"></app-footer>
